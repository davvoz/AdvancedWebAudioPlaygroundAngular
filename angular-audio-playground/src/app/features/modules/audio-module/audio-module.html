<div 
  class="audio-module"
  [style.left.px]="position.x"
  [style.top.px]="position.y">
  
  <div class="module-header" (mousedown)="onHeaderMouseDown($event)">
    <span class="module-title">{{ module.getTitle() }}</span>
    <button class="module-close" (click)="onRemove()" (mousedown)="$event.stopPropagation()">Ã—</button>
  </div>

  <div class="module-body">
    <!-- Controls Section -->
    @if (getControls().length > 0) {
      <div class="module-controls">
        @for (control of getControls(); track control.id) {
          <div class="control-group">
            <label class="control-label">
              {{ control.label }}
              @if (control.unit) {
                <span class="control-unit">({{ control.unit }})</span>
              }
            </label>
            
            @switch (control.type) {
              @case ('range') {
                <div class="control-range-container">
                  <input 
                    type="range"
                    class="control-range"
                    [min]="control.logarithmic ? 0 : (control.min ?? 0)"
                    [max]="control.logarithmic ? 100 : (control.max ?? 1)"
                    [step]="control.logarithmic ? 0.1 : (control.step ?? 0.01)"
                    [value]="getSliderValue(control)"
                    [title]="control.label"
                    (input)="onSliderChange(control, +$any($event.target).value)"
                    (mousedown)="$event.stopPropagation()" />
                  <input 
                    type="number"
                    class="control-number-inline"
                    [min]="control.min ?? 0"
                    [max]="control.max ?? 1"
                    [step]="control.step ?? 0.01"
                    [value]="control.value"
                    [title]="control.label"
                    (input)="onControlChange(control, $any($event.target).value)"
                    (mousedown)="$event.stopPropagation()" />
                </div>
              }
              @case ('number') {
                <div class="control-range-container">
                  <input 
                    type="range"
                    class="control-range"
                    [min]="control.logarithmic ? 0 : (control.min ?? 0)"
                    [max]="control.logarithmic ? 100 : (control.max ?? 100)"
                    [step]="control.logarithmic ? 0.1 : (control.step ?? 1)"
                    [value]="getSliderValue(control)"
                    [title]="control.label"
                    (input)="onSliderChange(control, +$any($event.target).value)"
                    (mousedown)="$event.stopPropagation()" />
                  <input 
                    type="number"
                    class="control-number-inline"
                    [min]="control.min ?? 0"
                    [max]="control.max ?? 100"
                    [step]="control.step ?? 1"
                    [value]="control.value"
                    [title]="control.label"
                    (input)="onControlChange(control, $any($event.target).value)"
                    (mousedown)="$event.stopPropagation()" />
                </div>
              }
              @case ('select') {
                <select 
                  class="control-select"
                  [ngModel]="control.value"
                  [title]="control.label"
                  (ngModelChange)="onControlChange(control, $event)"
                  (mousedown)="$event.stopPropagation()">
                  @for (option of control.options; track option.value) {
                    <option [value]="option.value">{{ option.label }}</option>
                  }
                </select>
              }
              @case ('checkbox') {
                <input 
                  type="checkbox"
                  class="control-checkbox"
                  [ngModel]="control.value"
                  [title]="control.label"
                  (ngModelChange)="onControlChange(control, $event)"
                  (mousedown)="$event.stopPropagation()" />
              }
            }
          </div>
        }
      </div>
    }

    <!-- Ports Section -->
    <div class="ports-container">
      <div class="ports inputs">
        @for (port of getInputPorts(); track port) {
          <div 
            class="port input"
            (click)="onPortClick(port, 'input')">
            <span class="port-label">{{ port }}</span>
            <div class="port-dot"></div>
          </div>
        }
      </div>

      <div class="ports outputs">
        @for (port of getOutputPorts(); track port) {
          <div 
            class="port output"
            (click)="onPortClick(port, 'output')">
            <div class="port-dot"></div>
            <span class="port-label">{{ port }}</span>
          </div>
        }
      </div>
    </div>
  </div>
</div>
